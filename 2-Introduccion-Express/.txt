IntroducciÃ³n a Express Js

ğŸŸ  [OBJETIVO] Levantar un servidor con Express Js que ofrezca una API REST
para leer y agregar datos en un archivo JSON local

 ğŸŸ Crear desde el backend una ruta GET usando Express Js 
 ğŸŸ Crear desde el backend una ruta GET para listar un conjunto de
  recursos en Express Js 
 ğŸŸ Crear una ruta POST en un backend para agregar datos en un
  JSON local  


ğŸŸ¢-IntroducciÃ³n
  Â¿QuÃ© son los servidores Web?
  Un servidor web es una aplicaciÃ³n backend creada
  para recibir solicitudes de aplicaciones clientes y
  devolver informaciÃ³n o inclusive sitios web.
  Usualmente, desde el servidor utilizaremos bases de
  datos para la persistencia de datos, lo cual
  aprenderemos mÃ¡s adelante.

ğŸŸ¢-Servidor web con el modulo http
  Servidor HTTP con Node.js https://medium.com/@diego.coder/servidor-http-con-node-js-3e594f3f2733


ğŸŸ¢-IntroducciÃ³n a express. Â¿QuÃ© es express?
  Express Js es un framework de JavaScript para la creaciÃ³n de servidores y API REST en un entorno
  Node Js.
  Es utilizado por varias de las empresas mÃ¡s grandes del mundo como PayPal, Uber, Netflix, LinkedIn,
  IBM y muy probablemente tambiÃ©n se estÃ© usando en tu aplicaciÃ³n favorita.
  Los desarrolladores que prefieren Express Js como herramienta de trabajo tÃ­picamente lo ocupan por
  ser significativamente minimalista, con una sintaxis intuitiva y declarativa, ademÃ¡s del poco tiempo de
  desarrollo y lÃ­neas de cÃ³digo que se necesita para empezar servidores y servicios web

  ğŸŸ¡InstalaciÃ³n de Express Js
    Para empezar a utilizar Express js primero hay que instalarlo por npm, para esto crea una nueva
    carpeta, dentro de la carpeta ejecuta la siguiente lÃ­nea de comando para iniciar un proyecto NPM:
    Ahora instalemos Express con la siguiente lÃ­nea de comando:
    npm init -y AsegÃºrate que el nombre de la carpeta no incluya mayÃºsculas
    npm install express
    Luego de instalarse deberÃ¡s ver
    â€œexpressâ€ en el archivo package.json

  ğŸŸ¡ CreaciÃ³n de rutas
    Creemos nuestro primer proyecto titulado Hola mundo en donde creemos un servidor para devolver un
    string que diga â€œHello World Express Jsâ€ en una ruta GET /home
    Para esto crea un archivo index.js y escribe en Ã©l el siguiente cÃ³digo:
    const express = require('express')
    const app = express()
    app.listen(3000, console.log("Â¡Servidor encendido!"))
    app.get("/home", (req, res) => {
    res.send("Hello World Express Js")
    })

  ğŸŸ¡ Levantando mi servidor
    Lo siguiente serÃ¡ ejecutar el archivo
    index.js por la terminal para levantar
    el servidor
    node index.js
    Ahora que nuestro servidor estÃ¡ levantado, solo
    deberÃ¡s abrir el navegador y escribir la siguiente
    URL:
    http://localhost:3000/home

  ğŸŸ¡ Con la instancia app podremos crear todas las rutas que necesitemos. Solo debemos cumplir la siguiente
      sintaxis:
      En donde:
      â— app: Es una instancia de Express.
      â— method: Es un mÃ©todo de solicitud HTTP en minÃºscula.
      â— path: Es la ruta que serÃ¡ consultada por la aplicaciÃ³n cliente, por ejemplo /home
      â— callback: Es la funciÃ³n que se ejecutarÃ¡ cuando la ruta sea consultada.

ğŸŸ¢-Arquitectura Cliente - Servidor
  La creaciÃ³n de servidores consiste en permitir la comunicaciÃ³n entre 2 aplicaciones que requieren
  compartir informaciÃ³n o la posibilidad de ejecutar funciones a partir de consultas HTTP.
  Esto mismo se conoce como la arquitectura Cliente - Servidor
  En donde tenemos un cliente que
  realiza una consulta y un servidor
  que procesa la consulta y emite
  una respuesta.

  ğŸŸ¡ El objeto request(req) y response(res)
      Los servidores disponibilizan datos y funciones a travÃ©s de rutas y en cada una de ellas tenemos acceso a 2
      parÃ¡metros conocidos como el request y el response.
      En donde el request corresponde a la informaciÃ³n de la consulta recibida en el servidor, mientras que el
      response serÃ¡ la respuesta que le daremos a las aplicaciones clientes

      En Express el request y el response son objetos que podemos utilizar para obtener el detalle de la consulta y
      poder dar respuesta:
      Existen varios atributos y mÃ©todos en cada objeto, pero para esta clase solo ocuparemos los siguientes:

      Request:
      â— req.body: Devuelve el payload o cuerpo de la consulta
      Response:
      â— res.send(): Devuelve como respuesta de la consulta lo que sea asignado como argumento
      â— res.json(): Devuelve en formato JSON lo que sea asignado como argumento 

ğŸŸ¢Devolviendo un JSON en una ruta
    Frecuentemente, crearemos una API REST para entregar informaciÃ³n a partir de una consulta bajo el
    mÃ©todo GET

ğŸŸ¢Recibiendo un payload
  Hasta ahora solo hemos devuelto informaciÃ³n a
  un cliente que consulta una de nuestras rutas:
  Sin embargo, en muchas ocasiones
  necesitaremos recibir datos de parte del cliente

  El payload se entiende como la â€œcargaâ€ dentro de
  una consulta. En express esta carga se encuentra en
  el atributo body del objeto request
  Al recibir datos de parte del cliente podemos
  utilizarlos para por ejemplo registrar un nuevo
  producto en nuestra base de datos (por ahora solo
  un json local).
  Request: {
  body: {
  "id": 3,
  "nombre": "Monitor",
  "precio": 59990
  }
  }

  Para poder leer el payload es necesario realizar una pequeÃ±a configuraciÃ³n en nuestra instancia app. Esta
  configuraciÃ³n consiste en ejecutar una funciÃ³n antes de cada ruta para parsear el contenido enviado desde el
  cliente. Para entender bien lo que vamos a hacer tenemos que conocer el concepto de middleware.

  ğŸŸ¡Â¿QuÃ© son los middlewares?
    Un middleware, particularmente un HTTP
    middleware, es una capa intermedia que envuelve la
    aplicaciÃ³n con la finalidad de procesar el request y
    el response.
    Los middleware pueden ser usados para procesar
    fÃ¡cilmente los payloads, aÃ±adir headers, comprimir
    los response, manejar autenticaciÃ³n

    El siguiente diagrama nos ayudarÃ¡ a entender cÃ³mo funciona
    Consulta a endpoint =>  Se ejecuta el middleware => Se ejecuta la funciÃ³n callback de la ruta

    En Express Js los middlewares se declaran con el mÃ©todo .use() de express, pasando como argumento el
    middleware.
    Para eso agregamos la siguiente lÃ­nea en nuestro servidor
    app.use(express.json())

  ğŸŸ¡CreaciÃ³n de una ruta POST
     Ahora creemos una ruta POST que sea utilizada para agregar un nuevo producto en nuestro JSON local. 

ğŸŸ¢Eliminando un recurso
    Ahora que ya sabemos listar recursos y agregar nuevos, procedamos a implementar la
    funcionalidad de borrado utilizando una ruta DELETE /productos/:id
    En esta ruta serÃ¡ necesario que el cliente nos especifique el id del producto a eliminar, para
    esto ocuparemos los parÃ¡metros de la URL con el req.params.

    El req.params nos retorna un objeto con todos los parÃ¡metros de la URL, cada parÃ¡metro se
    identificarÃ¡ por los 2 puntos(:) antes del nombre del parÃ¡metro.
    Para eliminar el producto del arreglo ocupamos el mÃ©todo splice de los arreglos,
    posteriormente sobreescribimos el archivo productos.json. Cuando trabajemos con bases
    de datos haremos esto mismo de forma mÃ¡s eficiente.

ğŸŸ¢Modificando un recurso
  Para permitirle a una aplicaciÃ³n cliente modificar alguno de los productos que tenemos
  almacenados en el JSON crearemos una ruta PUT /productos/:id
  Esta ruta tiene la particularidad de recibir el id del producto a modificar como parÃ¡metro en
  la ruta, ademÃ¡s esperarÃ¡ recibir como payload el objeto del producto modificado para
  sustituirlo en el JSON.

ğŸŸ¢Devolviendo un HTML desde el servidor
  Es posible devolver archivos desde Express a travÃ©s de una ruta GET utilizando el mÃ©todo
  sendFile() del objeto response
  ğŸŸ¡ app.get("/", (req, res) => {
  res.sendFile(__dirname + "/index.html")
  })
  El mÃ©todo sendFile() recibe como argumento la ruta absoluta de un archivo, por este motivo
  ocupamos un objeto global llamado __dirname que nos devuelve la direcciÃ³n del script en el
  que se ejecuta, en este caso equivale a la direcciÃ³n de la carpeta del proyecto en nuestro
  computador.

  Al devolver una aplicaciÃ³n cliente desde el mismo backend en donde tenemos el servidor y
  la API REST se le conoce como desarrollo de aplicaciones monolÃ­ticas, sin embargo, a
  continuaciÃ³n veremos que es posible separar completamente cada uno de estos elementos
  y de igual manera poder comunicarse entre sÃ­.

  ğŸŸ¡ Consultando ruta GET /productos desde otro servido
    Si abrimos la pestaÃ±a network de nuestro navegador y recargamos la pÃ¡gina, veremos que al
    intentar consultar la ruta GET http://localhost:3000/productos recibimos un error de CORS.

ğŸŸ¢CORS
  Los CORS, por sus siglas en inglÃ©s Cross Origin Request Sharing o â€œIntercambio de Recursos
  de Origen Cruzadoâ€ son una polÃ­tica que permite la comunicaciÃ³n de 2 aplicaciones de
  orÃ­genes o dominios diferentes.

  Los servidores que creamos con Express Js bloquean las consultas de aplicaciones
  externas gracias a que los CORS estÃ¡n deshabilitados por defecto, no obstante podemos
  habilitarlos instalando un paquete de NPM llamado cors.

  npm install cors
  Y posteriormente escribiendo estas 2 lÃ­neas en nuestro servidor:
  const express = require('express')
  const app = express()
  const fs = require('fs')
  const cors = require('cors')
  app.listen(3000, console.log("Â¡Servidor encendido!"))
  app.use(cors())
  app.use(express.json())
 

ğŸŸ¢ğŸŸ¡ğŸ”´